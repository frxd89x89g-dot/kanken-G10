<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>漢検10級ゲーム</title>
  <style>
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Kaku Gothic ProN","Yu Gothic",sans-serif;
      background:#ffffff;
      margin:0;
      padding:20px;
      text-align:center;
    }
    h2{ margin:8px 0 14px; }
    .sub{ color:#555; font-size:14px; margin-bottom:10px; }
    .kanji{
      font-size:96px;
      margin:18px 0 10px;
      line-height:1;
      font-weight:800;
    }
    .prompt{
      font-size:20px;
      font-weight:700;
      margin:10px 0 12px;
      color:#222;
    }
    .choices button{
      display:block;
      width:100%;
      max-width:360px;
      margin:10px auto;
      padding:16px 14px;
      font-size:22px;
      border-radius:14px;
      border:none;
      background:#4f7cff;
      color:#fff;
      font-weight:800;
      touch-action: manipulation;
    }
    .choices button:active{ transform: translateY(1px); }

    /* 正誤表示（大きく） */
    .result{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,0.92);
      z-index:9999;
      padding:20px;
    }
    .resultBox{
      width:min(520px, 92vw);
      border-radius:18px;
      padding:22px 18px;
      box-shadow:0 18px 40px rgba(0,0,0,.12);
      border:2px solid rgba(0,0,0,.06);
      background:#fff;
    }
    .ok{ color:#16a34a; font-size:56px; font-weight:900; margin:0 0 10px; }
    .ng{ color:#ef4444; font-size:56px; font-weight:900; margin:0 0 10px; }
    .ans{ font-size:22px; font-weight:800; }
    .small{ margin-top:10px; color:#555; font-size:14px; }

    /* かきじゅんの表示 */
    .dots{
      margin:12px 0 2px;
      font-size:26px;
      letter-spacing:4px;
    }
    .dot{ color:#111; opacity:.22; }
    .dot.red{ color:#ff3b30; opacity:1; font-weight:900; }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      max-width:640px;
      margin:0 auto;
    }
    .home{
      text-decoration:none;
      color:#4f7cff;
      font-weight:800;
      border:1px solid rgba(79,124,255,.25);
      padding:8px 12px;
      border-radius:999px;
    }
    .counter{
      font-weight:800;
      color:#333;
    }
  </style>
</head>
<body>

<div class="topbar">
  <a class="home" href="index.html">← ホーム</a>
  <div class="counter" id="counter">1 / 20</div>
</div>

<h2 id="title"></h2>
<div class="sub" id="sub"></div>
<div id="content"></div>

<!-- 正誤オーバーレイ -->
<div class="result" id="result">
  <div class="resultBox">
    <div id="resultText" class="ok">せいかい！</div>
    <div class="ans" id="answerText"></div>
    <div class="small">つぎのもんだいへ</div>
  </div>
</div>

<script>
/* ====== 完全オフライン：止まらない最終版 ====== */

/* 20問で終わる（試験まで回しやすい） */
const LIMIT = 20;

/* データ：よみ（生活で言いやすい短い形も許容） */
const DATA = [
  { k:"一", y:["いち","ひと"], s:1 },
  { k:"右", y:["みぎ"], s:5 },
  { k:"雨", y:["あめ"], s:8 },
  { k:"円", y:["えん"], s:4 },
  { k:"王", y:["おう"], s:4 },
  { k:"音", y:["おと"], s:9 },
  { k:"下", y:["した"], s:3 },
  { k:"火", y:["ひ"], s:4 },
  { k:"花", y:["はな"], s:7 },
  { k:"貝", y:["かい"], s:7 },
  { k:"学", y:["がく","まな"], s:8 },
  { k:"気", y:["き"], s:6 },
  { k:"九", y:["きゅう"], s:2 },
  { k:"休", y:["やす","やすむ"], s:6 },
  { k:"玉", y:["たま"], s:5 },
  { k:"金", y:["きん","かね"], s:8 },
  { k:"空", y:["そら"], s:8 },
  { k:"月", y:["つき"], s:4 },
  { k:"犬", y:["いぬ"], s:4 },
  { k:"見", y:["み","みる"], s:7 },
  { k:"五", y:["ご"], s:4 },
  { k:"口", y:["くち"], s:3 },
  { k:"校", y:["こう"], s:10 },
  { k:"左", y:["ひだり"], s:5 },
  { k:"三", y:["さん"], s:3 },
  { k:"山", y:["やま"], s:3 },
  { k:"子", y:["こ"], s:3 },
  { k:"四", y:["よん","し"], s:5 },
  { k:"糸", y:["いと"], s:6 },
  { k:"字", y:["じ"], s:6 },
  { k:"耳", y:["みみ"], s:6 },
  { k:"七", y:["なな","しち"], s:2 },
  { k:"車", y:["くるま"], s:7 },
  { k:"手", y:["て"], s:4 },
  { k:"十", y:["じゅう","とお"], s:2 },
  { k:"出", y:["で","でる","だす"], s:5 },
  { k:"女", y:["おんな"], s:3 },
  { k:"小", y:["ちい","ちいさい"], s:3 },
  { k:"上", y:["うえ"], s:3 },
  { k:"森", y:["もり"], s:12 },
  { k:"人", y:["ひと"], s:2 },
  { k:"水", y:["みず"], s:4 },
  /* ここが質問のポイント：
     正：生活では「ただ」で言いがち → どっちでも正解にする */
  { k:"正", y:["ただ","ただしい"], s:5 },
  { k:"生", y:["い","いきる","なま"], s:5 },
  { k:"青", y:["あお"], s:8 },
  { k:"夕", y:["ゆう"], s:3 },
  { k:"石", y:["いし"], s:5 },
  { k:"赤", y:["あか"], s:7 },
  { k:"千", y:["せん"], s:3 },
  { k:"川", y:["かわ"], s:3 },
  { k:"先", y:["さき"], s:6 },
  { k:"早", y:["はや","はやい"], s:6 },
  { k:"草", y:["くさ"], s:9 },
  { k:"足", y:["あし"], s:7 },
  { k:"村", y:["むら"], s:7 },
  { k:"大", y:["おお","おおきい"], s:3 },
  { k:"男", y:["おとこ"], s:7 },
  { k:"竹", y:["たけ"], s:6 },
  { k:"中", y:["なか"], s:4 },
  { k:"虫", y:["むし"], s:6 },
  { k:"町", y:["まち"], s:7 },
  { k:"天", y:["てん"], s:4 },
  { k:"田", y:["た"], s:5 },
  { k:"土", y:["つち"], s:3 },
  { k:"二", y:["に"], s:2 },
  { k:"日", y:["ひ"], s:4 },
  /* 入：生活では「はい」で言いがち → どっちでも正解にする */
  { k:"入", y:["はい","はいる"], s:2 },
  { k:"年", y:["とし","ねん"], s:6 },
  { k:"白", y:["しろ"], s:5 },
  { k:"八", y:["はち"], s:2 },
  { k:"百", y:["ひゃく"], s:6 },
  { k:"文", y:["ぶん"], s:4 },
  { k:"木", y:["き"], s:4 },
  { k:"本", y:["ほん"], s:5 },
  { k:"名", y:["な","なまえ"], s:6 },
  { k:"目", y:["め"], s:5 },
  { k:"立", y:["た","たつ"], s:5 },
  { k:"力", y:["ちから"], s:2 },
  { k:"林", y:["はやし"], s:8 },
  { k:"六", y:["ろく"], s:4 }
];

const params = new URLSearchParams(location.search);
const mode = params.get("mode") || "yomi";

const titleEl = document.getElementById("title");
const subEl = document.getElementById("sub");
const contentEl = document.getElementById("content");
const counterEl = document.getElementById("counter");

const resultEl = document.getElementById("result");
const resultTextEl = document.getElementById("resultText");
const answerTextEl = document.getElementById("answerText");

let idx = 0;
let current = null;

function shuffle(a){
  const b=[...a];
  for(let i=b.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [b[i],b[j]]=[b[j],b[i]];
  }
  return b;
}
function randFrom(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

function setHeader(){
  const map = { yomi:"よみ", kaki:"かき", kakijun:"かきじゅん" };
  titleEl.textContent = map[mode] || "ゲーム";
  subEl.textContent =
    (mode==="yomi") ? "この かんじは なんて よむ？" :
    (mode==="kaki") ? "この よみの かんじは どれ？" :
    "あかいところは なんばんめ？";
}

function showResult(ok, answer){
  resultTextEl.className = ok ? "ok" : "ng";
  resultTextEl.textContent = ok ? "せいかい！" : "まちがい！";
  answerTextEl.textContent = ok ? "" : ("こたえ： " + answer);
  resultEl.style.display = "flex";
  setTimeout(()=>{
    resultEl.style.display = "none";
    nextQuestion();
  }, ok ? 650 : 850);
}

function makeButtons(options, correctValue, isCorrectFn){
  contentEl.innerHTML = "";
  const wrap = document.createElement("div");
  wrap.className = "choices";
  options.forEach(v=>{
    const b = document.createElement("button");
    b.type = "button";
    b.textContent = v;
    b.onclick = ()=>{
      const ok = isCorrectFn(v, correctValue);
      showResult(ok, correctValue);
    };
    wrap.appendChild(b);
  });
  contentEl.appendChild(wrap);
}

function questionYomi(d){
  contentEl.innerHTML = `<div class="kanji">${d.k}</div>`;
  // 選択肢：正解1 + 乱択2（「代表読み」を出す）
  const pool = DATA.map(x=>x.y[0]);
  const correct = d.y[0];
  const opts = new Set([correct]);
  while(opts.size<3){
    const cand = randFrom(pool);
    if(cand) opts.add(cand);
  }
  const options = shuffle([...opts]);
  // 判定：正解は d.y のどれでもOK（「ただ」も許す）
  makeButtons(options, correct, (picked)=>{
    return d.y.includes(picked);
  });
}

function questionKaki(d){
  contentEl.innerHTML = `<div class="kanji">${d.y[0]}</div>`;
  const pool = DATA.map(x=>x.k);
  const correct = d.k;
  const opts = new Set([correct]);
  while(opts.size<3){
    const cand = randFrom(pool);
    if(cand) opts.add(cand);
  }
  makeButtons(shuffle([...opts]), correct, (picked)=>picked===correct);
}

function questionKakijun(d){
  // 赤い点：必ず見える（太字＋赤）
  const n = 1 + Math.floor(Math.random()*d.s);
  contentEl.innerHTML = `<div class="kanji">${d.k}</div>`;

  const dots = document.createElement("div");
  dots.className = "dots";
  for(let i=1;i<=d.s;i++){
    const sp = document.createElement("span");
    sp.textContent = "●";
    sp.className = (i===n) ? "dot red" : "dot";
    dots.appendChild(sp);
  }
  contentEl.appendChild(dots);

  const correct = String(n);
  const opts = new Set([correct]);
  while(opts.size<3){
    const cand = String(1 + Math.floor(Math.random()*d.s));
    opts.add(cand);
  }
  makeButtons(shuffle([...opts]), correct, (picked)=>picked===correct);
}

function nextQuestion(){
  idx++;
  if(idx > LIMIT){
    // 終了画面
    contentEl.innerHTML = `
      <div style="margin-top:26px;font-size:34px;font-weight:900;">おしまい！</div>
      <div style="margin-top:10px;color:#555;font-weight:800;">ホームに戻って別モードもやろう</div>
      <div style="margin-top:18px;">
        <a href="index.html" style="display:inline-block;text-decoration:none;background:#4f7cff;color:#fff;padding:14px 18px;border-radius:14px;font-weight:900;font-size:18px;">ホームへ</a>
      </div>
    `;
    counterEl.textContent = `${LIMIT} / ${LIMIT}`;
    return;
  }

  counterEl.textContent = `${idx} / ${LIMIT}`;
  current = randFrom(DATA);

  if(mode==="yomi") return questionYomi(current);
  if(mode==="kaki") return questionKaki(current);
  return questionKakijun(current);
}

/* 起動 */
setHeader();
idx = 1;
counterEl.textContent = `${idx} / ${LIMIT}`;
current = randFrom(DATA);
if(mode==="yomi") questionYomi(current);
else if(mode==="kaki") questionKaki(current);
else questionKakijun(current);
</script>

</body>
</html>