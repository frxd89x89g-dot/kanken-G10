<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>かんけん10きゅう｜かきじゅん</title>

<style>
body {
  margin: 0;
  background: #fff8e7;
  font-family: -apple-system, BlinkMacSystemFont, "Hiragino Kaku Gothic ProN", sans-serif;
  color: #333;
}

.container {
  max-width: 420px;
  margin: 0 auto;
  padding: 20px;
  text-align: center;
}

.kanji {
  font-size: 120px;
  margin: 20px 0;
}

.question {
  font-size: 18px;
  margin-bottom: 12px;
}

.buttons button {
  width: 100%;
  padding: 14px;
  margin: 10px 0;
  font-size: 18px;
  border-radius: 12px;
  border: none;
  cursor: pointer;
  background: #e0ecff;
}

.buttons button:hover {
  background: #c7ddff;
}

.overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  display: none;
  align-items: center;
  justify-content: center;
}

.resultBox {
  background: white;
  padding: 30px;
  border-radius: 20px;
  text-align: center;
  width: 80%;
  max-width: 320px;
}

.resultBox.correct {
  border: 6px solid #4caf50;
}

.resultBox.wrong {
  border: 6px solid #f44336;
}

.resultText {
  font-size: 48px;
  margin-bottom: 20px;
}

.nextBtn {
  font-size: 20px;
  padding: 12px 24px;
  border-radius: 12px;
  border: none;
  background: #ffd54f;
  cursor: pointer;
}
</style>
</head>

<body>
<div class="container">
  <h2>かきじゅん</h2>
  <div id="kanji" class="kanji">山</div>
  <div class="question">あかいところは なんかくめ？</div>
  <div class="buttons" id="choices"></div>
</div>

<div class="overlay" id="overlay">
  <div class="resultBox" id="resultBox">
    <div class="resultText" id="resultText"></div>
    <button class="nextBtn" onclick="nextQuestion()">つぎへ</button>
  </div>
</div>

<script>
let strokesData = {};
let questions = [];
let index = 0;
let locked = false;

fetch("strokes.json")
  .then(res => res.json())
  .then(json => {
    strokesData = json.strokes;
    prepareQuestions();
    showQuestion();
  })
  .catch(() => {
    alert("strokes.json が読み込めません");
  });

function prepareQuestions() {
  questions = Object.keys(strokesData).map(k => ({
    kanji: k,
    count: strokesData[k].length
  }));
}

function showQuestion() {
  locked = false;
  const q = questions[index % questions.length];
  document.getElementById("kanji").textContent = q.kanji;

  const correct = Math.floor(Math.random() * q.count) + 1;
  const choices = new Set([correct]);
  while (choices.size < 3) {
    choices.add(Math.floor(Math.random() * q.count) + 1);
  }

  const btns = document.getElementById("choices");
  btns.innerHTML = "";

  [...choices].sort(() => Math.random() - 0.5).forEach(n => {
    const b = document.createElement("button");
    b.textContent = `${n}かくめ`;
    b.onclick = () => answer(n === correct);
    btns.appendChild(b);
  });
}

function answer(isCorrect) {
  if (locked) return;
  locked = true;

  const overlay = document.getElementById("overlay");
  const box = document.getElementById("resultBox");
  const text = document.getElementById("resultText");

  overlay.style.display = "flex";
  box.className = "resultBox " + (isCorrect ? "correct" : "wrong");
  text.textContent = isCorrect ? "⭕ せいかい！" : "❌ ざんねん";
}

function nextQuestion() {
  document.getElementById("overlay").style.display = "none";
  index++;
  showQuestion();
}
</script>
</body>
</html>
